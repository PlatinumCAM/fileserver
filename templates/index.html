<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Index ‚Äî {{ rel_path or '/' }}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div id="content">
    <h1>
        Contenu de : {{ rel_path or '/' }}
        <button id="theme-btn" onclick="toggleTheme()">Mode sombre</button>
    </h1>

    <table>
        <thead>
        <tr>
            <th>Nom</th>
            <th>Type</th>
            <th>Taille</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="file-list">
        {% if parent_link %}
        <tr>
            <td><a href="{{ parent_link }}">.. (Parent)</a></td>
            <td>R√©pertoire</td>
            <td></td>
            <td></td>
        </tr>
        {% endif %}
        {% for d in dirs %}
        <tr>
            <td><a href="{{ d.link }}">{{ d.name }}/</a></td>
            <td>R√©pertoire</td>
            <td class="meta">{{ d.count }} √©l√©ments</td>
            <td class="actions"><a href="{{ d.zip_link }}">T√©l√©charger .zip</a></td>
        </tr>
        {% endfor %}
        {% for f in files %}
        <tr class="file-row" data-mp3="{{ '1' if f.is_mp3 else '0' }}"
            data-src={{ f.stream_link|tojson }} data-cover={{ f.cover_link|tojson }}
            data-name={{ f.name|tojson }} data-album={{ f.album|tojson }}>
            <td>
                {% if f.is_mp3 %}
                <a onclick='playAudio({{ f.stream_link|tojson }}, {{ f.cover_link|tojson }}, {{ f.name|replace(".mp3","")|replace(".flac","")|tojson }}, {{ f.album|tojson }})'>
                    {{ f.name }}
                </a>
                {% else %}
                <a href="{{ f.link }}">{{ f.name }}</a>
                {% endif %}
            </td>
            <td>{{ 'Fichier audio' if f.is_mp3 else 'Fichier' }}</td>
            <td class="meta">{{ f.size }}</td>
            <td class="actions"><a href="{{ f.dl_link }}">T√©l√©charger</a></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div id="player-container">
    <img id="cover" src="" alt="Pochette">
    <div id="song-title"></div>
    <div id="album-name"></div>
    <audio id="audio-player" controls autoplay></audio>
    <div>
        <button class="player-btn" onclick="prevTrack()">‚èÆ Pr√©c√©dent</button>
        <button class="player-btn" onclick="nextTrack()">‚è≠ Suivant</button>
    </div>
    <div>
        <button class="player-btn" id="shuffle-btn" onclick="toggleShuffle()">üîÄ Normal</button>
        <button class="player-btn" id="loop-btn" onclick="toggleLoop()">üîÅ Non</button>
    </div>
    <button id="auto-btn" class="player-btn active" onclick="toggleAutoPlay()">Lecture auto : ON</button>
</div>
<script src="{{ url_for('static',filename='player.js') }}"></script>
<style>
    body {
       font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
       margin: 24px;
       background-color: var(--bg-color);
       background-image: url('{{ bg_url }}');
       background-size: cover;       /* remplit sans d√©formation */
       background-repeat: no-repeat; /* pas de r√©p√©tition */
       background-position: center;  /* centr√© */
       background-attachment: fixed; /* <-- cl√© : le fond ne bouge plus */
       color: var(--text-color);
       display: flex;
       flex-direction: row;
       justify-content: center;
       align-items: flex-start;
 }
</style>
</body>
</html>
